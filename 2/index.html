<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CS180 Project 1 — Colorizing the Prokudin‑Gorskii Collection • Maanit Sharma</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --border: #e2e8f0;
      --subtle: #f8fafc;
      --accent: #2563eb;
      --code: #f6f8fa;
    }
    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.6;
      color: var(--text);
      background: var(--bg);
    }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px 16px; }
    header.wrap { padding-top: 32px; padding-bottom: 8px; }
    .header-row { display: flex; align-items: center; justify-content: space-between; gap: 16px; }
    h1 { font-size: 1.9rem; margin: 0 0 4px; letter-spacing: -0.02em; }
    .meta { color: var(--muted); font-size: 0.95rem; }
    .badge { display:inline-block; padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); color: var(--muted); text-decoration: none; }

    .grid { display: grid; grid-template-columns: 260px 1fr; gap: 24px; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    aside { position: sticky; top: 16px; align-self: start; background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
    aside h2 { font-size: 1rem; margin: 0 0 8px; letter-spacing: 0.02em; color: var(--muted); }
    nav a { display:block; padding: 6px 8px; border-radius: 8px; color: var(--text); text-decoration: none; font-size: 0.95rem; }
    nav a:hover { background: var(--subtle); }
    nav a.active { background: #eef2ff; border: 1px solid #c7d2fe; }

    main section { padding: 24px; border: 1px solid var(--border); border-radius: 12px; background: #fff; margin-bottom: 24px; }
    section h2 { margin-top: 0; font-size: 1.35rem; }
    section h3 { margin-top: 1.2em; font-size: 1.1rem; }

    .callout { background: var(--subtle); border-left: 4px solid var(--accent); padding: 12px 12px; border-radius: 10px; }

    .figure-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    figure { margin: 0; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: #fff; }
    figure img { width: 100%; display: block; }
    figcaption { padding: 8px 10px; color: var(--muted); font-size: 0.92rem; border-top: 1px solid var(--border); }

    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid var(--border); padding: 8px 10px; text-align: left; }
    th { background: var(--subtle); }

    code, pre { background: var(--code); border-radius: 8px; }
    pre { padding: 12px; overflow: auto; }
    .small { color: var(--muted); font-size: 0.92rem; }
    .todo { background: #fff7ed; border: 1px dashed #fdba74; padding: 8px 10px; border-radius: 8px; display: inline-block; }

    footer { text-align: center; color: var(--muted); font-size: 0.9rem; padding: 24px 0 48px; }
  </style>
</head>
<body>
  <header class="wrap">
    <div class="header-row">
      <div>
        <h1>CS180 Project 1: Colorizing the Prokudin‑Gorskii Collection</h1>
        <div class="meta">Maanit Sharma · UC Berkeley · Fall 2025</div>
      </div>
      <a class="badge" href="../index.html">← Back to Main</a>
    </div>
  </header>

  <div class="wrap grid">
    <aside aria-label="Table of contents">
      <h2>Contents</h2>
      <nav id="toc">
        <a href="#overview">Overview</a>
        <a href="#single">Single‑Scale Alignment</a>
        <a href="#pyramid">Multi‑Level (Image Pyramid)</a>
        <a href="#results-provided">Results (Example Images)</a>
        <a href="#results-own">Results (Personal Choices)</a>
      </nav>
    </aside>

    <main>
      <!-- OVERVIEW -->
      <section id="overview">
        <h2>Overview</h2>
        <p>
          This project re‑creates color photographs from glass plate negatives in the Prokudin‑Gorskii collection.
          Each source image consists of three monochrome channels (B, G, R) stacked vertically. The task is to align
          the channels and combine them into an RGB image.
        </p>
        <p>
          I implemented two alignment methods:
        </p>
        <ol>
          <li><strong>Single‑Scale exhaustive search</strong> over integer shifts within a small window using a similarity metric.</li>
          <li><strong>Multi‑Level pyramid search</strong> that aligns from coarse to fine scales for speed and robustness.</li>
        </ol>
        <div class="callout">
          <strong>Metrics.</strong> I experimented with L1, L2, and NCC (normalized cross‑correlation). Cropping ~5–10% off
          borders before scoring improved stability by avoiding misguiding edges.
        </div>
        <p class="small">If any images proved difficult, I describe what went wrong and how I tried to fix it in
          <a href="#failures">Misalignments & Analysis</a>.</p>
      </section>

      <!-- SINGLE SCALE -->
      <section id="single">
        <h2>Single‑Scale Alignment Approach</h2>
        <p>
          I treat the <strong>blue (B)</strong> channel as the fixed reference. For each of the <strong>red (R)</strong>
          and <strong>green (G)</strong> channels, I exhaustively search integer shifts from <strong>−15 to +15 pixels</strong>
          in both <em>x</em> and <em>y</em>. Each candidate shift is scored against the reference on the
          <em>cropped interior</em>—I remove about <strong>6% of the max image dimension</strong> from all sides to avoid
          misleading border artifacts from the plate splits.
        </p>
        <ul>
          <li><strong>Metrics tested:</strong> L2 (squared‑error), L1 (sum of absolute differences), and NCC (normalized cross‑correlation).</li>
          <li><strong>Selection rule:</strong> choose the shift that minimizes L1/L2 or maximizes NCC.</li>
          <li><strong>What I use most:</strong> L1, because the three channels often differ in brightness/contrast; L1’s absolute‑difference
            error is noticeably more stable than L2/NCC under those conditions.</li>
          <li><strong>Finalize:</strong> apply the chosen shifts to the <em>uncropped</em> R and G, then stack into an RGB image.</li>
        </ul>
        <p class="small">Offsets are reported as <code>(dx, dy)</code> for R and G relative to B (<code>+dx</code> right, <code>+dy</code> down).</p>
      </section>

      <!-- PYRAMID -->
      <section id="pyramid">
        <h2>Multi‑Level Alignment (Image Pyramid) Approach</h2>
        <p>
          To make alignment on large <code>.tif</code> plates both <em>faster</em> and <em>more robust</em>, I use a
          <strong>4‑level Gaussian pyramid</strong> for each channel (repeatedly downsampling by 2× until either
          four levels are built or the smallest dimension reaches ~64 px). In my algorithm, I downsampled input images with the resize() function from the skimage 
          library. This resize function also performs Gaussian smoothing when downsampling by setting anti_aliasing to True, which led to higher level downsampled images looking more like
          lower level images in the image pyramid compared to when no Gaussian smoothing was used. As a result, this Gaussian smoothing during resizing led to better alignment.
        </p>
        <ol>
          <li><strong>Coarsest pass:</strong> at the lowest‑resolution level, run the same single‑scale search with a
            <strong>±15 px</strong> window to get an initial shift.</li>
          <li><strong>Propagate upward:</strong> move to the next finer level, <strong>double</strong> the shift to account for the 2× change in scale,</li>
          <li><strong>Local refinement:</strong> refine the estimate in a small neighborhood of <strong>±2 px</strong> around the doubled shift.</li>
          <li><strong>Repeat</strong> the propagate‑and‑refine step until full resolution; then apply the final shifts to the
            <em>uncropped</em> R and G and stack into RGB.</li>
        </ol>
        <p class="small">At every level, scoring uses the same cropped‑interior trick (~6%) to avoid border bias. This pyramid cut
          runtime substantially on high‑res images while improving reliability on challenging scenes.</p>
      </section>

      <!-- RESULTS: PROVIDED IMAGES -->
      <section id="results-provided">
        <h2>Results (Example Images)</h2>

        <h3>Resulting Images</h3>
        <div class="figure-grid">
          <figure>
            <img src="./media/cathedral.jpg" alt="cathedral result" />
            <figcaption>cathedral • R: (3, 9) • G: (2, 4)</figcaption>
          </figure>
          <figure>
            <img src="./media/monastery.jpg" alt="monastery result" />
            <figcaption>monastery • R: (2, 3) • G: (2, -3)</figcaption>
          </figure>
          <figure>
            <img src="./media/tobolsk.jpg" alt="tobolsk result" />
            <figcaption>tobolsk • R: (3, 6) • G: (3, 3)</figcaption>
          </figure>
          <figure>
            <img src="./media/emir.jpg" alt="emir result" />
            <figcaption>emir • R: (42, 104) • G: (24, 49)</figcaption>
          </figure>
          <figure>
            <img src="./media/italil.jpg" alt="italil result" />
            <figcaption>italil • R: (35, 76) • G: (21, 38)</figcaption>
          </figure>
          <figure>
            <img src="./media/church.jpg" alt="church result" />
            <figcaption>church • R: (-4, 58) • G: (4, 25)</figcaption>
          </figure>
          <figure>
            <img src="./media/three_generations.jpg" alt="three_generations result" />
            <figcaption>three_generations • R: (10, 112) • G: (13, 54)</figcaption>
          </figure>
          <figure>
            <img src="./media/chapel.jpg" alt="chapel result" />
            <figcaption>chapel • R: (0, 115) • G: (1, 34)</figcaption>
          </figure>
          <figure>
            <img src="./media/lugano.jpg" alt="lugano result" />
            <figcaption>lugano • R: (-29, 92) • G: (-16, 41)</figcaption>
          </figure>
          <figure>
            <img src="./media/melons.jpg" alt="melons result" />
            <figcaption>melons • R: (14, 178) • G: (11, 82)</figcaption>
          </figure>
          <figure>
            <img src="./media/lastochikino.jpg" alt="lastochikino result" />
            <figcaption>lastochikino • R: (-7, 76) • G: (-1, -3)</figcaption>
          </figure>
          <figure>
            <img src="./media/icon.jpg" alt="icon result" />
            <figcaption>icon • R: (22, 91) • G: (17, 41)</figcaption>
          </figure>
          <figure>
            <img src="media/siren.jpg" alt="siren result" />
            <figcaption>siren • R: (-26, 97) • G: (-7, 50)</figcaption>
          </figure>
          <figure>
            <img src="./media/self_portrait.jpg" alt="self_portrait result" />
            <figcaption>self_portrait • R: (37, 175) • G: (27, 77)</figcaption>
          </figure>
          <figure>
            <img src="./media/harvesters.jpg" alt="harvesters result" />
            <figcaption>harvesters • R: (14, 124) • G: (17, 60)</figcaption>
          </figure>
        </div>

        <h3>Offsets Table</h3>
        <table>
          <thead>
            <tr>
              <th>Image</th>
              <th>Method</th>
              <th>R offset (dx, dy)</th>
              <th>G offset (dx, dy)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>cathedral.jpg</td>
              <td>Single</td>
              <td>(3, 9)</td>
              <td>(2, 4)</td>
            </tr>
            <tr>
              <td>monastery.jpg</td>
              <td>Single</td>
              <td>(2, 3)</td>
              <td>(2, -3)</td>
            </tr>
            <tr>
              <td>tobolsk.jpg</td>
              <td>Single</td>
              <td>(3, 6)</td>
              <td>(3, 3)</td>
            </tr>
            <tr>
              <td>emir.tif</td>
              <td>Pyramid</td>
              <td>(42, 104)</td>
              <td>(24, 49)</td>
            </tr>
            <tr>
              <td>italil.tif</td>
              <td>Pyramid</td>
              <td>(35, 76)</td>
              <td>(21, 38)</td>
            </tr>
            <tr>
              <td>church.tif</td>
              <td>Pyramid</td>
              <td>(-4, 58)</td>
              <td>(4, 25)</td>
            </tr>
            <tr>
              <td>three_generations.tif</td>
              <td>Pyramid</td>
              <td>(10, 112)</td>
              <td>(13, 54)</td>
            </tr>
            <tr>
              <td>chapel.tif</td>
              <td>Pyramid</td>
              <td>(0, 115)</td>
              <td>(1, 34)</td>
            </tr>
            <tr>
              <td>lugano.tif</td>
              <td>Pyramid</td>
              <td>(-29, 92)</td>
              <td>(-16, 41)</td>
            </tr>
            <tr>
              <td>melons.tif</td>
              <td>Pyramid</td>
              <td>(14, 178)</td>
              <td>(11, 82)</td>
            </tr>
            <tr>
              <td>lastochikino.tif</td>
              <td>Pyramid</td>
              <td>(-7, 76)</td>
              <td>(-1, -3)</td>
            </tr>
            <tr>
              <td>icon.tif</td>
              <td>Pyramid</td>
              <td>(22, 91)</td>
              <td>(17, 41)</td>
            </tr>
            <tr>
              <td>siren.tif</td>
              <td>Pyramid</td>
              <td>(-26, 97)</td>
              <td>(-7, 50)</td>
            </tr>
            <tr>
              <td>self_portrait.tif</td>
              <td>Pyramid</td>
              <td>(37, 175)</td>
              <td>(27, 77)</td>
            </tr>
            <tr>
              <td>harvesters.tif</td>
              <td>Pyramid</td>
              <td>(14, 124)</td>
              <td>(17, 60)</td>
            </tr>
          </tbody>
        </table>

        <p>
          Offsets are reported as <strong>(dx, dy)</strong> for the <strong>R</strong> and <strong>G</strong> channels
          relative to <strong>B</strong> (positive <code>dx</code> = shift right, positive <code>dy</code> = shift down).
        </p>
      </section>

      <!-- RESULTS: OWN PICKS -->
      <section id="results-own">
        <h2>Results (Personal Choices from Prokudin‑Gorskii)</h2>

        <div class="figure-grid" style="margin-top: 12px;">
          <figure>
            <img src="./media/forest_road.jpg" alt="forest_road result" />
            <figcaption>forest_road • R: (1, 10) • G: (-3, 4)</figcaption>
          </figure>
          <figure>
            <img src="./media/courtyard.jpg" alt="courtyard result" />
            <figcaption>courtyard • R: (4, 11) • G: (2, 5)</figcaption>
          </figure>
          <figure>
            <img src="./media/piony.jpg" alt="piony result" />
            <figcaption>piony • R: (-5, 104) • G: (4, 50)</figcaption>
          </figure>
          <figure>
            <img src="./media/milan_cathedral.jpg" alt="milan_cathedral result" />
            <figcaption>milan_cathedral • R: (-54, -4) • G: (-19, 10)</figcaption>
          </figure>
          <figure>
            <img src="./media/cherry_tree.jpg" alt="cherry_tree result" />
            <figcaption>cherry_tree • R: (-83, 22) • G: (-94, -31)</figcaption>
          </figure>
          <figure>
            <img src="./media/island_capri.jpg" alt="island_capri result" />
          <figure>
        <div>
     
        <h3>Offsets Table</h3>
  
        <table>
          <thead>
            <tr>
              <th>Image</th>
              <th>Method</th>
              <th>R offset (dx, dy)</th>
              <th>G offset (dx, dy)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>forest_road.jpg</td>
              <td>Single</td>
              <td>(1, 10)</td>
              <td>(-3, 4)</td>
            </tr>
            <tr>
              <td>courtyard.jpg</td>
              <td>Single</td>
              <td>(4, 11)</td>
              <td>(2, 5)</td>
            </tr>
            <tr>
              <td>piony.tif</td>
              <td>Pyramid</td>
              <td>(-5, 104)</td>
              <td>(4, 50)</td>
            </tr>
            <tr>
              <td>milan_cathedral.tif</td>
              <td>Pyramid</td>
              <td>(-54, -4)</td>
              <td>(-19, 10)</td>
            </tr>
            <tr>
              <td>cherry_tree.tif</td>
              <td>Pyramid</td>
              <td>(-83, 22)</td>
              <td>(-94, -31)</td>
            </tr>
            <tr>
              <td>island_capri.tif</td>
              <td>Pyramid</td>
              <td>(-10, 102)</td>
              <td>(-12, 45)</td>
            </tr>
          </tbody>
        </table>
      <section>

  <footer>
    © <span id="year"></span> Maanit Sharma · CS180 Project 1
  </footer>

  <script>
    // highlight active TOC link
    const links = Array.from(document.querySelectorAll('#toc a'));
    const sections = links.map(a => document.querySelector(a.getAttribute('href')));
    const io = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const i = sections.indexOf(entry.target);
        if (i >= 0) {
          const link = links[i];
          if (entry.isIntersecting) link.classList.add('active');
          else link.classList.remove('active');
        }
      });
    }, { rootMargin: '-40% 0px -50% 0px', threshold: 0.01 });
    sections.forEach(sec => sec && io.observe(sec));

    // year stamp
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
