<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CS180 Project 1 — Colorizing the Prokudin‑Gorskii Collection • Maanit Sharma</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --border: #e2e8f0;
      --subtle: #f8fafc;
      --accent: #2563eb;
      --code: #f6f8fa;
    }
    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.6;
      color: var(--text);
      background: var(--bg);
    }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px 16px; }
    header.wrap { padding-top: 32px; padding-bottom: 8px; }
    .header-row { display: flex; align-items: center; justify-content: space-between; gap: 16px; }
    h1 { font-size: 1.9rem; margin: 0 0 4px; letter-spacing: -0.02em; }
    .meta { color: var(--muted); font-size: 0.95rem; }
    .badge { display:inline-block; padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); color: var(--muted); text-decoration: none; }

    .grid { display: grid; grid-template-columns: 260px 1fr; gap: 24px; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    aside { position: sticky; top: 16px; align-self: start; background: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
    aside h2 { font-size: 1rem; margin: 0 0 8px; letter-spacing: 0.02em; color: var(--muted); }
    nav a { display:block; padding: 6px 8px; border-radius: 8px; color: var(--text); text-decoration: none; font-size: 0.95rem; }
    nav a:hover { background: var(--subtle); }
    nav a.active { background: #eef2ff; border: 1px solid #c7d2fe; }

    main section { padding: 24px; border: 1px solid var(--border); border-radius: 12px; background: #fff; margin-bottom: 24px; }
    section h2 { margin-top: 0; font-size: 1.35rem; }
    section h3 { margin-top: 1.2em; font-size: 1.1rem; }

    .callout { background: var(--subtle); border-left: 4px solid var(--accent); padding: 12px 12px; border-radius: 10px; }

    .figure-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    @media (max-width: 800px) { .figure-grid { grid-template-columns: 1fr; } }
    figure { margin: 0; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: #fff; }
    figure img { width: 100%; display: block; }
    figcaption { padding: 8px 10px; color: var(--muted); font-size: 0.92rem; border-top: 1px solid var(--border); }

    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid var(--border); padding: 8px 10px; text-align: left; }
    th { background: var(--subtle); }

    code, pre { background: var(--code); border-radius: 8px; }
    pre { padding: 12px; overflow: auto; }
    .small { color: var(--muted); font-size: 0.92rem; }
    .todo { background: #fff7ed; border: 1px dashed #fdba74; padding: 8px 10px; border-radius: 8px; display: inline-block; }

    /* Prevent wide tables from pushing layout */
    .table-wrap { overflow-x: auto; }

    footer { text-align: center; color: var(--muted); font-size: 0.9rem; padding: 24px 0 48px; }
  </style>
</head>
<body>
  <header class="wrap">
    <div class="header-row">
      <div>
        <h1>CS180 Project 1: Colorizing the Prokudin‑Gorskii Collection</h1>
        <div class="meta">Maanit Sharma · UC Berkeley · Fall 2025</div>
      </div>
      <a class="badge" href="../index.html">← Back to Main</a>
    </div>
  </header>

  <div class="wrap grid">
    <aside aria-label="Table of contents">
      <h2>Contents</h2>
      <nav id="toc">
        <a href="#overview">Overview</a>
        <a href="#single">Single‑Scale Alignment</a>
        <a href="#pyramid">Multi‑Level Alignment (Image Pyramid)</a>
        <a href="#misalignment">Misalignment: emir (L2 → L1)</a>
      </nav>
      <div class="small" style="margin-top:10px;">Tip: use JPG/PNG only. Don’t upload the large .tif files.</div>
    </aside>

    <main>
      <!-- OVERVIEW -->
      <section id="overview">
        <h2>Overview</h2>
        <p>
          This project re‑creates color photographs from glass plate negatives in the Prokudin‑Gorskii collection.
          Each source image consists of three monochrome channels (B, G, R) stacked vertically. The task is to align
          the channels and combine them into an RGB image.
        </p>
        <p>
          I implemented two alignment methods:
        </p>
        <ol>
          <li><strong>Single‑Scale exhaustive search</strong> over integer shifts within a small window using a similarity metric.</li>
          <li><strong>Multi‑Level pyramid search</strong> that aligns from coarse to fine scales for speed and robustness.</li>
        </ol>
        <div class="callout">
          <strong>Metrics.</strong> I experimented with L1, L2, and NCC (normalized cross‑correlation). Cropping ~5–10% off
          borders before scoring improved stability by avoiding misguiding edges.
        </div>
        <p class="small">If any images proved difficult, I describe what went wrong and how I tried to fix it in
          <a href="#failures">Misalignments & Analysis</a>.</p>
      </section>

      <!-- SINGLE SCALE -->
      <section id="single">
        <h2>Single‑Scale Alignment — Approach</h2>
        <p>
          I treat the <strong>blue (B)</strong> channel as the fixed reference. For each of the <strong>red (R)</strong>
          and <strong>green (G)</strong> channels, I exhaustively search integer shifts from <strong>−15 to +15 pixels</strong>
          in both <em>x</em> and <em>y</em>. Each candidate shift is scored against the reference on the
          <em>cropped interior</em>—I remove about <strong>6% of the max image dimension</strong> from all sides to avoid
          misleading border artifacts from the plate splits.
        </p>
        <ul>
          <li><strong>Metrics tested:</strong> L2 (squared‑error), L1 (sum of absolute differences), and NCC (normalized cross‑correlation).</li>
          <li><strong>Selection rule:</strong> choose the shift that minimizes L1/L2 or maximizes NCC.</li>
          <li><strong>What I use most:</strong> L1, because the three channels often differ in brightness/contrast; L1’s absolute‑difference
            error is noticeably more stable than L2/NCC under those conditions.</li>
          <li><strong>Finalize:</strong> apply the chosen shifts to the <em>uncropped</em> R and G, then stack into an RGB image.</li>
        </ul>
        <p class="small">Offsets are reported as <code>(dx, dy)</code> for R and G relative to B (<code>+dx</code> right, <code>+dy</code> down).</p>
      </section>

      <!-- PYRAMID -->
      <section id="pyramid">
        <h2>Multi‑Level Alignment (Image Pyramid) — Approach</h2>
        <p>
          To make alignment on large <code>.tif</code> plates both <em>faster</em> and <em>more robust</em>, I use a
          <strong>4‑level Gaussian pyramid</strong> for each channel (repeatedly downsampling by 2× until either
          four levels are built or the smallest dimension reaches ~64 px).
        </p>
        <ol>
          <li><strong>Coarsest pass:</strong> at the lowest‑resolution level, run the same single‑scale search with a
            <strong>±15 px</strong> window to get an initial shift.</li>
          <li><strong>Propagate upward:</strong> move to the next finer level, <strong>double</strong> the shift to account for the 2× change in scale,</li>
          <li><strong>Local refinement:</strong> refine the estimate in a small neighborhood of <strong>±2 px</strong> around the doubled shift.</li>
          <li><strong>Repeat</strong> the propagate‑and‑refine step until full resolution; then apply the final shifts to the
            <em>uncropped</em> R and G and stack into RGB.</li>
        </ol>
        <p class="small">At every level, scoring uses the same cropped‑interior trick (~6%) to avoid border bias. This pyramid cut
          runtime substantially on high‑res images while improving reliability on challenging scenes.</p>
      </section>

      <!-- RESULTS: PROVIDED IMAGES -->
      <section id="single-results-ex-l2">
        <h2>Single‑Scale (L2) — Example Results</h2>
        <div class="figure-grid">
          <figure>
            <img src="./media/cathedral_l2_norm.jpg" alt="cathedral result (L2)" />
            <figcaption>cathedral • R: (3, 12) • G: (2, 5)</figcaption>
          </figure>
          <figure>
            <img src="./media/monastery_l2_norm.jpg" alt="monastery result (L2)" />
            <figcaption>monastery • R: (2, 3) • G: (2, -3)</figcaption>
          </figure>
          <figure>
            <img src="./media/tobolsk_l2_norm.jpg" alt="tobolsk result (L2)" />
            <figcaption>tobolsk • R: (3, 6) • G: (3, 3)</figcaption>
          </figure>
        </div>
      </section>

      <section id="single-offsets-ex-l2">
        <h3>Single‑Scale (L2) — Example Offsets</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Image</th>
                <th>R offset (dx, dy)</th>
                <th>G offset (dx, dy)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>cathedral.jpg</td>
                <td>(3, 12)</td>
                <td>(2, 5)</td>
              </tr>
              <tr>
                <td>monastery.jpg</td>
                <td>(2, 3)</td>
                <td>(2, -3)</td>
              </tr>
              <tr>
                <td>tobolsk.jpg</td>
                <td>(3, 6)</td>
                <td>(3, 3)</td>
  <section id="pyramid">
        <h2>Multi‑Level Alignment (Image Pyramid) — Approach</h2>
        <p>
          To make alignment on large <code>.tif</code> plates both <em>faster</em> and <em>more robust</em>, I use a
          <strong>4‑level Gaussian pyramid</strong> for each channel (repeatedly downsampling by 2× until either four
          levels are built or the smallest dimension reaches ~64 px).
        </p>
        <ol>
          <li><strong>Coarsest pass:</strong> at the lowest‑resolution level, run the same single‑scale search with a
            <strong>±15 px</strong> window to get an initial shift.</li>
          <li><strong>Propagate upward:</strong> move to the next finer level, <strong>double</strong> the shift to account for the 2× change in scale,</li>
          <li><strong>Local refinement:</strong> refine the estimate in a small neighborhood of <strong>±2 px</strong> around the doubled shift.</li>
          <li><strong>Repeat:</strong> repeat the propagate‑and‑refine step until full resolution; then apply the final shifts to the
            <em>uncropped</em> R and G and stack into RGB.</li>
        </ol>
        <p class="small">At every level, scoring uses the same cropped‑interior trick (~6%) to avoid border bias. This pyramid cut runtime substantially on high‑res images while improving reliability on challenging scenes.</p>
      </section>

      <section id="pyramid-resultsy>
          </table>
        </div>
      </section>

      <section id="single-results-custom-l2">
        <h2>Single‑Scale (L2) — Custom Results</h2>
        <div class="figure-grid">
          <figure>
            <img src="./media/forest_road_l2_norm.jpg" alt="forest_road result (L2)" />
            <figcaption>forest_road • R: (1, 10) • G: (-3, 3)</figcaption>
          </figure>
          <figure>
            <img src="./media/courtyard_l2_norm.jpg" alt="courtyard result (L2)" />
            <figcaption>courtyard • R: (4, 11) • G: (2, 5)</figcaption>
          </figure>
        </div>
      </section>

      <section id="single-offsets-custom-l2">
        <h3>Single‑Scale (L2) — Custom Offsets</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Image</th>
                <th>R offset (dx, dy)</th>
                <th>G offset (dx, dy)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>forest_road.jpg</td>
                <td>(1, 10)</td>
                <td>(-3, 3)</td>
              </tr>
              <tr>
                <td>courtyard.jpg</td>
                <td>(4, 11)</td>
                <td>(2, 5)</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="pyramid-results-ex-l2">
        <h2>Multi‑Level (Pyramid, L2) — Example Results</h2>
        <div class="figure-grid">
          <figure>
            <img src="./media/emir_l2_norm.jpg" alt="emir result (L2)" />
            <figcaption>emir.tif • R: (-257, 90) • G: (24, 49)</figcaption>
          </figure>
          <figure>
            <img src="./media/italil_l2_norm.jpg" alt="italil result (L2)" />
            <figcaption>italil.tif • R: (35, 76) • G: (21, 38)</figcaption>
          </figure>
          <figure>
            <img src="./media/church_l2_norm.jpg" alt="church result (L2)" />
            <figcaption>church.tif • R: (-4, 58) • G: (4, 25)</figcaption>
          </figure>
          <figure>
            <img src="./media/three_generations_l2_norm.jpg" alt="three_generations result (L2)" />
            <figcaption>three_generations.tif • R: (11, 112) • G: (14, 53)</figcaption>
          </figure>
          <figure>
            <img src="./media/lugano_l2_norm.jpg" alt="lugano result (L2)" />
            <figcaption>lugano.tif • R: (-29, 92) • G: (-16, 41)</figcaption>
          </figure>
          <figure>
            <img src="./media/melons_l2_norm.jpg" alt="melons result (L2)" />
            <figcaption>melons.tif • R: (13, 179) • G: (10, 82)</figcaption>
          </figure>
          <figure>
            <img src="./media/lastochikino_l2_norm.jpg" alt="lastochikino result (L2)" />
            <figcaption>lastochikino.tif • R: (-8, 75) • G: (-2, -2)</figcaption>
          </figure>
          <figure>
            <img src="./media/icon_l2_norm.jpg" alt="icon result (L2)" />
            <figcaption>icon.tif • R: (23, 89) • G: (17, 40)</figcaption>
          </figure>
          <figure>
            <img src="./media/siren_l2_norm.jpg" alt="siren result (L2)" />
            <figcaption>siren.tif • R: (-25, 95) • G: (-6, 49)</figcaption>
          </figure>
          <figure>
            <img src="./media/self_portrait_l2_norm.jpg" alt="self_portrait result (L2)" />
            <figcaption>self_portrait.tif • R: (36, 176) • G: (28, 78)</figcaption>
          </figure>
          <figure>
            <img src="./media/harvesters_l2_norm.jpg" alt="harvesters result (L2)" />
            <figcaption>harvesters.tif • R: (13, 124) • G: (16, 59)</figcaption>
          </figure>
        </div>
      </section>

      <section id="pyramid-offsets-ex-l2">
        <h3>Multi‑Level (Pyramid, L2) — Example Offsets</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Image (.tif)</th>
                <th>R offset (dx, dy)</th>
                <th>G offset (dx, dy)</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>emir.tif</td><td>(-257, 90)</td><td>(24, 49)</td></tr>
              <tr><td>italil.tif</td><td>(35, 76)</td><td>(21, 38)</td></tr>
              <tr><td>church.tif</td><td>(-4, 58)</td><td>(4, 25)</td></tr>
              <tr><td>three_generations.tif</td><td>(11, 112)</td><td>(14, 53)</td></tr>
              <tr><td>lugano.tif</td><td>(-29, 92)</td><td>(-16, 41)</td></tr>
              <tr><td>melons.tif</td><td>(13, 179)</td><td>(10, 82)</td></tr>
              <tr><td>lastochikino.tif</td><td>(-8, 75)</td><td>(-2, -2)</td></tr>
              <tr><td>icon.tif</td><td>(23, 89)</td><td>(17, 40)</td></tr>
              <tr><td>siren.tif</td><td>(-25, 95)</td><td>(-6, 49)</td></tr>
              <tr><td>self_portrait.tif</td><td>(36, 176)</td><td>(28, 78)</td></tr>
              <tr><td>harvesters.tif</td><td>(13, 124)</td><td>(16, 59)</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="pyramid-results-custom-l2">
        <h2>Multi‑Level (Pyramid, L2) — Custom Results</h2>
        <div class="figure-grid">
          <figure>
            <img src="./media/cherry_tree_l2_norm.jpg" alt="cherry_tree result (L2)" />
            <figcaption>cherry_tree.tif • R: (-82, 22) • G: (-94, -30)</figcaption>
          </figure>
          <figure>
            <img src="./media/island_capri_l2_norm.jpg" alt="island_capri result (L2)" />
            <figcaption>island_capri.tif • R: (-10, 102) • G: (-13, 40)</figcaption>
          </figure>
          <figure>
            <img src="./media/milan_cathedral_l2_norm.jpg" alt="milan_cathedral result (L2)" />
            <figcaption>milan_cathedral.tif • R: (-53, -3) • G: (-19, -9)</figcaption>
          </figure>
          <figure>
            <img src="./media/piony_l2_norm.jpg" alt="piony result (L2)" />
            <figcaption>piony.tif • R: (-6, 104) • G: (3, 51)</figcaption>
          </figure>
        </div>
      </section>

      <section id="pyramid-offsets-custom-l2">
        <h3>Multi‑Level (Pyramid, L2) — Custom Offsets</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Image (.tif)</th>
                <th>R offset (dx, dy)</th>
                <th>G offset (dx, dy)</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>cherry_tree.tif</td><td>(-82, 22)</td><td>(-94, -30)</td></tr>
              <tr><td>island_capri.tif</td><td>(-10, 102)</td><td>(-13, 40)</td></tr>
              <tr><td>milan_cathedral.tif</td><td>(-53, -3)</td><td>(-19, -9)</td></tr>
              <tr><td>piony.tif</td><td>(-6, 104)</td><td>(3, 51)</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="misalignment">
        <h2>Misalignment — <code>emir.tif</code> (L2 vs L1)</h2>
        <p>
          With <strong>L2</strong>, the squared error emphasizes large brightness differences between channels.
          In <code>emir.tif</code>, the red robe and skin tones differ a lot across B/G/R exposures, so L2 over‑weights those
          mismatched intensities and can lock onto a poor alignment (very large erroneous shift). Switching to <strong>L1</strong>
          makes the score more robust by linearizing those differences, producing a visually correct alignment.
        </p>
        <div class="figure-grid">
          <figure>
            <img src="./media/emir_l2_norm.jpg" alt="emir misaligned (L2)" />
            <figcaption>Before — L2 (misaligned) • R: (-257, 90) • G: (24, 49)</figcaption>
          </figure>
          <figure>
            <img src="./media/emir_l1_norm.jpg" alt="emir corrected (L1)" />
            <figcaption>After — L1 (corrected)</figcaption>
          </figure>
        </div>
      </section>

      <!-- RESULTS: OWN PICKS -->
      

      <!-- FAILURES / ANALYSIS -->
      <section id="failures">
        <h2>Misalignments & Analysis</h2>
        <p>
          If any images failed to align cleanly, briefly explain hypotheses and attempted fixes.
        </p>
        <ul>
          <li><strong>High‑contrast borders</strong> (black/white frames) biased the metric → fixed by cropping 6–10%.</li>
          <li><strong>Brightness/contrast differences</strong> across channels → tried gradient/edge maps before scoring.</li>
          <li><strong>Fine repetitive texture</strong> (e.g., bricks) → used pyramid + smaller refine window at finer levels.</li>
          <li><strong>Motion between plates</strong> (subject moved) → residual ghosting noted in captions.</li>
          <li><strong>Non‑rigid distortions</strong> (lens/scan) → outside scope of rigid shift; minor blur left.</li>
        </ul>
        <p class="small"><span class="todo">TODO:</span> Drop in thumbnails of any problematic outputs and 1–2 lines describing what you tried.</p>

        <h3>Runtime Notes</h3>
        <ul>
          <li>Single‑scale exhaustive search over ±w took ~__ s per image at full resolution.</li>
          <li>Pyramid (levels: __) cut runtime to ~__ s with similar/better accuracy.</li>
        </ul>
      </section>

      <section>
        <h2>Repro & File Notes</h2>
        <ul>
          <li>All images on this page are compressed (<code>.jpg</code>/<code>.png</code>); <em>no</em> large <code>.tif</code> files are included.</li>
          <li>Offsets reported as <code>(dx, dy)</code> with <code>dx</code>=right, <code>dy</code>=down relative to <strong>B</strong>.</li>
          <li>Output naming I used: <code>name_method_metric.jpg</code> (e.g., <code>emir_pyramid_l1.jpg</code>).</li>
        </ul>
      </section>
    </main>
  </div>

  <footer>
    © <span id="year"></span> Maanit Sharma · CS180 Project 1
  </footer>

  <script>
    // highlight active TOC link
    const links = Array.from(document.querySelectorAll('#toc a'));
    const sections = links.map(a => document.querySelector(a.getAttribute('href')));
    const io = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const i = sections.indexOf(entry.target);
        if (i >= 0) {
          const link = links[i];
          if (entry.isIntersecting) link.classList.add('active');
          else link.classList.remove('active');
        }
      });
    }, { rootMargin: '-40% 0px -50% 0px', threshold: 0.01 });
    sections.forEach(sec => sec && io.observe(sec));

    // year stamp
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
